<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	  xmlns:ui="http://java.sun.com/jsf/facelets"  
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:c="http://java.sun.com/jsp/jstl/core">
      
<h:body>
	<f:metadata>
		<f:event listener="#{loginBean.isAdmin}" type="preRenderView" />
	</f:metadata>
	<ui:composition template="/templates/mainTemplate.xhtml">
		<ui:define name="title">Gestión de Usuarios - SCANOA</ui:define>
		<ui:define name="content">
			<h3>Gestión de cuentas de usuario</h3>
			<h:form id="formUsers">
				<p:growl id="msgs" showDetail="true" globalOnly="true"/>
				<div id="optionsOA">
					<p:commandButton value="Ver usuario" icon="ui-icon-person"
		            	update=":detailUserForm" oncomplete="PF('detailUserDialog').show()"/>
					<p:commandButton value="Agregar usuario" icon="ui-icon-plus"
		            	oncomplete="PF('addUserDialog').show()"/>
		         	<p:commandButton value="Editar usuario" icon="ui-icon-wrench"
		              	update=":editUserForm" oncomplete="PF('editUserDialog').show()"/>
					<p:commandButton value="Eliminar usuario" icon="ui-icon-trash"
		        		update=":deleteUserForm" oncomplete="PF('deleteUserDialog').show()"/>
				</div>
				<div id="datatablePanel">
					<p:dataTable id="tableUsers" var="user" value="#{accountManagerBean.users}" widgetVar="usersTable"
						selectionMode="single" selection="#{accountManagerBean.selectedUser}" rowKey="#{user.correo}"
						paginator="true" rows="10"
						emptyMessage="No se encontraron usuarios"
						filteredValue="#{accountManagerBean.filteredUsers}"
						paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink}">
						
						<f:facet name="header">
				            <p:outputPanel>
				                <h:outputText value="Buscar:" />
				                <p:inputText id="globalFilter" onkeyup="PF('usersTable').filter()" style="width:150px" placeholder=""/>
				            </p:outputPanel>
				        </f:facet>
						
						<p:column headerText="Correo" sortBy="#{user.correo}" filterBy="#{user.correo}" filterStyle="display:none">
							<h:outputText value="#{user.correo}" />
						</p:column>
		 
						<p:column headerText="Nombre" sortBy="#{user.nombre}" filterBy="#{user.nombre}" filterStyle="display:none">
							<h:outputText value="#{user.nombre}" />
						</p:column>
						
						<p:column headerText="Tipo" sortBy="#{user.tipo}" filterBy="#{user.tipo}" filterStyle="display:none">
							<h:outputText rendered="#{user.tipo==1}" value="Administrador"/>
							<h:outputText rendered="#{user.tipo==2}" value="Miembro"/>
						</p:column>	
					</p:dataTable>
				</div>
			</h:form>
			
			<h:form id="detailUserForm">
				<p:outputPanel id="panelNotNull" layout="block" rendered="#{accountManagerBean.selectedUser != null}">
					<p:dialog header="Detalles del usuario" showEffect="fade" hideEffect="fade" widgetVar="detailUserDialog" modal="true" resizable="false">
						<table>
							<tr>
								<td>Nombre:</td>
								<td><h:outputText value="#{accountManagerBean.selectedUser.nombre}"/></td>
							</tr>
							<tr>
								<td>Correo:</td>
								<td><h:outputText value="#{accountManagerBean.selectedUser.correo}"/></td>
							</tr>
							<tr>
								<td>Tipo:</td>
								<td>
									<h:outputText rendered="#{accountManagerBean.selectedUser.tipo==1}" value="Administrador"/>
									<h:outputText rendered="#{accountManagerBean.selectedUser.tipo==2}" value="Miembro"/>
								</td>
							</tr>
							<tr>
								<td>Fecha de registro:</td>
								<td><h:outputText value="#{accountManagerBean.selectedUser.fecha_registro}"/></td>
							</tr>
							<f:facet name="footer">
								<p:commandButton value="Cerrar" onclick="PF('detailUserDialog').hide();" ajax="true" icon="ui-icon-closethick"/>
							</f:facet>
						</table>
					</p:dialog>
				</p:outputPanel>
				<p:outputPanel id="panelNull" layout="block" rendered="#{accountManagerBean.selectedUser == null}">
					<p:dialog header="Detalles del usuario" showEffect="fade" hideEffect="fade" widgetVar="detailUserDialog" modal="true" resizable="false">
						<p style="width:300px; text-align:center;">Debe seleccionar un usuario para visualizar.</p>
						<f:facet name="footer">
							<p:commandButton value="Cerrar" onclick="PF('detailUserDialog').hide();" ajax="true" icon="ui-icon-closethick"/>
						</f:facet>
					</p:dialog>
				</p:outputPanel>
			</h:form>
			
			<h:form id="addUserForm">
				<p:dialog header="Agregar usuario" showEffect="fade" hideEffect="fade" widgetVar="addUserDialog" modal="true" resizable="false">
					<table>
						<tr>
							<td>Ingrese correo:</td>
							<td>
								<p:inputText id="addCorreo" value="#{accountManagerBean.correoAMB}" required="true" 
									requiredMessage="Debe ingresar un correo electrónico.">
									<f:validator validatorId="correoValidator" />
								</p:inputText>
							</td>
						</tr>
						<tr>
							<td colspan="2"><p:message for="addCorreo" severity="error"></p:message></td>
						</tr>
						<tr>
							<td>Ingrese nombre:</td>
							<td>
								<p:inputText id="addNombre" value="#{accountManagerBean.nombreAMB}" required="true" 
									requiredMessage="Debe ingresar un nombre."/>
							</td>
						</tr>
						<tr>
							<td colspan="2"><p:message for="addNombre" severity="error"></p:message></td>
						</tr>
						<tr>
							<td>Ingrese contraseña:</td>
							<td>
								<p:password id="addContraseña" value="#{accountManagerBean.contraseñaAMB}" required="true" 
								requiredMessage="Debe ingresar una contraseña."/>
							</td>
						</tr>
						<tr>
							<td colspan="2"><p:message for="addContraseña" severity="error"></p:message></td>
						</tr>
						<tr>
							<td>Tipo de usuario:</td>
							<td>
						        <p:selectOneRadio id="addTipo" value="#{accountManagerBean.tipoUsuarioAMB}" required="true" 
									requiredMessage="Debe seleccionar un tipo de usuario.">
						            <f:selectItem itemLabel="Administrador" itemValue="1" />
						            <f:selectItem itemLabel="Miembro" itemValue="2" />
						        </p:selectOneRadio>
						    </td>
						</tr>
						<tr>
							<td colspan="2"><p:message for="addTipo" severity="error"></p:message></td>
						</tr>
						<f:facet name="footer">
							<p:commandButton action="#{accountManagerBean.addUser}" value="Agregar" 
								update=":formUsers,:addUserForm" oncomplete="if(args.validationFailed) {addUserDialog.show()}"
								ajax="true" icon="ui-icon-plus">
							</p:commandButton>
						</f:facet>
					</table>
				</p:dialog>
			</h:form>
			
			<h:form id="editUserForm" >
				<p:outputPanel id="panelNotNull" layout="block" rendered="#{accountManagerBean.selectedUser != null}">
					<p:dialog header="Editar usuario ''#{accountManagerBean.selectedUser.nombre}''" widgetVar="editUserDialog"
					showEffect="fade" hideEffect="fade"  modal="true" resizable="false">
						<table>
							<tr>
								<td>Ingrese correo:</td>
								<td>
									<p:inputText id="editCorreo" value="#{accountManagerBean.correoAMB}">
										<f:validator validatorId="correoValidator" />
										<p:watermark for="editCorreo" value="#{accountManagerBean.selectedUser.correo}" />
									</p:inputText>
								</td>
							</tr>
							<tr>
								<td colspan="2"><p:message for="editCorreo" severity="error"></p:message></td>
							</tr>
							<tr>
								<td>Ingrese nombre:</td>
								<td>
									<p:inputText id="editNombre" value="#{accountManagerBean.nombreAMB}">
										<p:watermark for="editNombre" value="#{accountManagerBean.selectedUser.nombre}" />
									</p:inputText>
								</td>
							</tr>
							<tr>
								<td colspan="2">
									
								</td>
							</tr>
							<tr>
								<td>Ingrese contraseña:</td>
								<td>
									<p:password id="editContraseña" value="#{accountManagerBean.contraseñaAMB}">
									</p:password>
								</td>
							</tr>
							<tr>
								<td colspan="2">
									
								</td>
							</tr>
							<tr>
								<td>Tipo de usuario:</td>
								<td>
							        <p:selectOneRadio id="editTipo" value="#{accountManagerBean.tipoUsuarioAMB}">
							            <f:selectItem itemLabel="Administrador" itemValue="1" />
							            <f:selectItem itemLabel="Miembro" itemValue="2" />
							        </p:selectOneRadio>
							    </td>
							</tr>
							<tr>
							<td colspan="2">
							</td>
						</tr>
							<f:facet name="footer">
								<p:commandButton action="#{accountManagerBean.editUser}" value="Editar" 
									update=":formUsers,:editUserForm" oncomplete="if(args.validationFailed) {editUserDialog.show()}"
									ajax="true" icon="ui-icon-wrench">
								</p:commandButton>
							</f:facet>
						</table>	
					</p:dialog>
				</p:outputPanel>
				<p:outputPanel id="panelNull" layout="block" rendered="#{accountManagerBean.selectedUser == null}">
					<p:dialog header="Editar OA" widgetVar="editUserDialog"
					showEffect="fade" hideEffect="fade"  modal="true" resizable="false">
						<p style="width:300px; text-align:center;">Debe seleccionar un usuario para editar</p>
						<f:facet name="footer">
							<p:commandButton value="Cerrar" onclick="PF('editUserDialog').hide();" ajax="true" icon="ui-icon-closethick"/>
						</f:facet>
					</p:dialog>
				</p:outputPanel>
			</h:form>
			
			<h:form id="deleteUserForm">
				<p:outputPanel id="panelNotNull" layout="block" rendered="#{accountManagerBean.selectedUser != null}">
					<p:dialog header="Eliminar usuario" showEffect="fade" hideEffect="fade" widgetVar="deleteUserDialog" modal="true" resizable="false">
						<p style="width:400px; text-align:center;">¿Esta seguro de eliminar al usuario "#{accountManagerBean.selectedUser.nombre}"?</p>
						<f:facet name="footer">
							<p:commandButton action="#{accountManagerBean.deleteUser}" value="Si" 
								update=":formUsers,:deleteUserForm" ajax="true" icon="ui-icon-check"/>
							<p:commandButton value="No" onclick="PF('deleteUserDialog').hide();" ajax="true" icon="ui-icon-closethick"/>
						</f:facet>
					</p:dialog>
				</p:outputPanel>
				<p:outputPanel id="panelNull" layout="block" rendered="#{accountManagerBean.selectedUser == null}">
					<p:dialog header="Eliminar usuario" showEffect="fade" hideEffect="fade" widgetVar="deleteUserDialog" modal="true" resizable="false">
						<p style="width:300px; text-align:center;">Debe seleccionar un usuario para eliminar</p>
						<f:facet name="footer">
							<p:commandButton value="Cerrar" onclick="PF('deleteUserDialog').hide();" ajax="true" icon="ui-icon-closethick"/>
						</f:facet>
					</p:dialog>
				</p:outputPanel>
			</h:form>
			
			<p:ajaxStatus onstart="PF('statusDialog').show()" onsuccess="PF('statusDialog').hide()" />
			<p:dialog widgetVar="statusDialog" modal="true" draggable="false" closable="false" resizable="false" showHeader="false">
			    <p:graphicImage name="img/ajaxloader.gif" />
			</p:dialog>
				
		</ui:define>
	</ui:composition>
</h:body>

</html>