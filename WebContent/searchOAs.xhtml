<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	  xmlns:ui="http://java.sun.com/jsf/facelets" 
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:p="http://primefaces.org/ui">
      
<h:body>
	<ui:composition template="/templates/mainTemplate.xhtml">
		<ui:define name="title">Búsqueda de OAs - SCANOA</ui:define>
		<ui:define name="content">
			<div id="contentOAs">
				<h3>Búsqueda de Objetos de Aprendizaje</h3>
			
				<h:form id="formEngineSearch">
					<p:growl id="msgs" showDetail="true" globalOnly="true"/>
					<div id="inputSearch">
						<p:commandButton value="Buscar por título" icon="ui-icon-search" action="#{searchOAsBean.searchByTitulo}" update=":formListOAs"/>
						<p:inputText value="#{searchOAsBean.inputSearchTitulo}"></p:inputText>
						<p:commandButton value="Buscar por descripción" icon="ui-icon-search" action="#{searchOAsBean.searchByDescripcion}" update=":formListOAs"/>
						<p:inputText value="#{searchOAsBean.inputSearchDescripcion}"></p:inputText>
					</div>
					<div id="topicSearch">
						<p:commandButton value="Buscar por tópico" icon="ui-icon-search" action="#{searchOAsBean.searchByTopic}" update=":formListOAs"/>
						<p:scrollPanel mode="native" style="margin-top:5px; width:100%; height:135px; border:none;">
							<p:tree value="#{topicManagerBean.root}" var="topic" selectionMode="single"
                				selection="#{topicManagerBean.selectedNode}" 
                				style="width:99%; font-size:14px; border:none; background:white;">
								<p:treeNode>
						            <h:outputText value="#{topic.label}" />
						        </p:treeNode>
							</p:tree>
						</p:scrollPanel>
					</div>
				</h:form>	
				
				<h:form id="formListOAs">
					<div id="optionsResult">
						<p:commandButton value="Ver OA" icon="ui-icon-document" disabled="#{!(searchOAsBean.disable)}"
			            	update=":detailOAForm" oncomplete="PF('detailOADialog').show()"/>
					</div>
					
					<div id="dtResultOAsPanel">					
						<p:dataTable var="oa" value="#{searchOAsBean.oas}" emptyMessage="No se han encontrado objetos de aprendizajes"
							selectionMode="single" selection="#{searchOAsBean.selectedOA}" rowKey="#{oa.id}">
						    <p:column headerText="Objeto de aprendizaje">
						        <h:outputText value="#{oa.titulo}" />
						    </p:column>
						</p:dataTable>
					</div>
				</h:form>
				
				<h:form id="detailOAForm">
					<p:outputPanel id="panelNotNull" layout="block" rendered="#{searchOAsBean.selectedOA != null}">
						<p:dialog header="Detalles del objeto de aprendizaje" showEffect="fade" hideEffect="fade" widgetVar="detailOADialog" modal="true" resizable="false">
							<div id="tableDetailOA">
								<table>
									<tr>
										<td class="column1">Título:</td>
										<td class="column2"><h:outputText value="#{searchOAsBean.selectedOA.titulo}"/></td>
									</tr>
									<tr>
										<td>Descripción:</td>
										<td><h:outputText value="#{searchOAsBean.selectedOA.descripcion}"/></td>
									</tr>
									<tr>
										<td>Categorizado en (Relevancia descendiente):</td>
										<td>
											<ul>
						                		<ui:repeat var="topic" value="#{searchOAsBean.selectedOA.rankTopicos}">
						                			<li><h:outputText value="#{topic.label}" /></li>
						                		</ui:repeat>
					                		</ul>
					                	</td>
									</tr>
									<tr>
										<td>URL:</td>
										<td><h:outputLink target="_blank" value="#{searchOAsBean.selectedOA.url}">#{searchOAsBean.selectedOA.url}</h:outputLink></td>
									</tr>
								</table>
							</div>
							<f:facet name="footer">
								<p:commandButton value="Cerrar" onclick="PF('detailOADialog').hide();" ajax="true" icon="ui-icon-closethick"/>
							</f:facet>
						</p:dialog>
					</p:outputPanel>
					<p:outputPanel id="panelNull" layout="block" rendered="#{searchOAsBean.selectedOA == null}">
						<p:dialog header="Detalles del objeto de aprendizaje" showEffect="fade" hideEffect="fade" widgetVar="detailOADialog" modal="true" resizable="false">
							<p style="width:300px; text-align:center;">Debe seleccionar un objeto de aprendizaje para visualizar.</p>
							<f:facet name="footer">
								<p:commandButton value="Cerrar" onclick="PF('detailOADialog').hide();" ajax="true" icon="ui-icon-closethick"/>
							</f:facet>
						</p:dialog>
					</p:outputPanel>
				</h:form>
									
				<p:ajaxStatus onstart="PF('statusDialog').show()" onsuccess="PF('statusDialog').hide()" />
				<p:dialog widgetVar="statusDialog" modal="false" draggable="false" closable="false" resizable="false" showHeader="false">
				    <p:graphicImage name="img/ajaxloader.gif" />
				</p:dialog>
			</div>	
		</ui:define>
	</ui:composition>
	
</h:body>
</html>