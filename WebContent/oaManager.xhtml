<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	  xmlns:ui="http://java.sun.com/jsf/facelets" 
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:p="http://primefaces.org/ui">
      
<h:body>
	<f:metadata>
		<f:event listener="#{loginBean.isAdmin}" type="preRenderView" />
	</f:metadata>
	<ui:composition template="/templates/mainTemplate.xhtml">
		<ui:define name="title">Gestión de OAs - SCANOA</ui:define>
		<ui:define name="content">
			<h3>Gestión de objetos de aprendizajes</h3>
			<h:form id="formEngineSearch">
				<div id="inputSearch">
					<p:commandButton value="Buscar por título" icon="ui-icon-search" action="#{oaManagerBean.searchByTitulo}" update=":formOAs"/>
					<p:inputText value="#{oaManagerBean.inputSearchTitulo}"></p:inputText>
					<p:commandButton value="Buscar por descripción" icon="ui-icon-search" action="#{oaManagerBean.searchByDescripcion}" update=":formOAs"/>
					<p:inputText value="#{oaManagerBean.inputSearchDescripcion}"></p:inputText>
				</div>
				<div id="topicSearch">
					<p:commandButton value="Buscar por tópico" icon="ui-icon-search" action="#{oaManagerBean.searchByTopic}" update=":formOAs"/>
					<p:scrollPanel mode="native" style="margin-top:5px; width:100%; height:135px; border:none;">
						<p:tree value="#{topicManagerBean.root}" var="topic" selectionMode="single"
               				selection="#{topicManagerBean.selectedNode}" 
               				style="width:99%; font-size:14px; border:none; background:white;">
							<p:treeNode>
					            <h:outputText value="#{topic.label}" />
					        </p:treeNode>
						</p:tree>
					</p:scrollPanel>
				</div>
			</h:form>	
			
			<h:form id="formOAs">
				<p:growl id="msgs" showDetail="true" globalOnly="true"/>
				<div id="optionsOA">
					<p:commandButton value="Ver OA" icon="ui-icon-document"
		            	update=":detailOAForm" oncomplete="PF('detailOADialog').show()"/>
					<p:commandButton value="Agregar OA" icon="ui-icon-plus"
		            	oncomplete="PF('addOADialog').show()"/>
		         	<p:commandButton value="Editar OA" icon="ui-icon-wrench"
		              	update=":editOAForm" oncomplete="PF('editOADialog').show()"/>
					<p:commandButton value="Eliminar OA" icon="ui-icon-trash"
		        		update=":deleteOAForm" oncomplete="PF('deleteOADialog').show()"/>
				</div>
				<div id="datatablePanel">
					<p:dataTable id="tableOAs" var="oa" value="#{oaManagerBean.oas}" widgetVar="oasTable"
						selectionMode="single" selection="#{oaManagerBean.selectedOA}" rowKey="#{oa.id}"
						paginator="true" rows="10"
						emptyMessage="No se encontraron objetos de aprendizaje"
						filteredValue="#{oaManagerBean.filteredOAs}"
						paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink}">
						
						<f:facet name="header">
				            <p:outputPanel>
				                <h:outputText value="Buscar:" />
				                <p:inputText id="globalFilter" onkeyup="PF('oasTable').filter()" style="width:150px" placeholder=""/>
				            </p:outputPanel>
				        </f:facet>
						
						<p:column headerText="Id" sortBy="#{oa.id}" filterBy="#{oa.id}" filterStyle="display:none">
							<h:outputText value="#{oa.id}" />
						</p:column>
						
						<p:column headerText="Título" sortBy="#{oa.titulo}" filterBy="#{oa.titulo}" filterStyle="display:none">
							<h:outputText value="#{oa.titulo}" />
						</p:column>
						
						<p:column headerText="Correo de usuario" sortBy="#{oa.usuario}" filterBy="#{oa.usuario}" filterStyle="display:none">
							<h:outputText value="#{oa.usuario}" />
						</p:column>
					</p:dataTable>
				</div>
			</h:form>
			
			<h:form id="detailOAForm">
				<p:outputPanel id="panelNotNull" layout="block" rendered="#{oaManagerBean.selectedOA != null}">
					<p:dialog header="Detalles del objeto de aprendizaje" showEffect="fade" hideEffect="fade" widgetVar="detailOADialog" modal="true" resizable="false">
						<div id="tableDetailOA">
							<table>
								<tr>
									<td class="column1">Id:</td>
									<td class="column2"><h:outputText value="#{oaManagerBean.selectedOA.id}"/></td>
								</tr>
								<tr>
									<td>Título:</td>
									<td><h:outputText value="#{oaManagerBean.selectedOA.titulo}"/></td>
								</tr>
								<tr>
									<td>Descripción:</td>
									<td><h:outputText value="#{oaManagerBean.selectedOA.descripcion}"/></td>
								</tr>
								<tr>
				                	<td><h:outputText value="Categorizado en (Relevancia descendiente):" /></td>
				                	<td>
				                		<ul>
					                		<ui:repeat var="topic" value="#{oaManagerBean.selectedOA.rankTopicos}">
					                			<li><h:outputText value="#{topic.label}" /></li>
					                		</ui:repeat>
				                		</ul>
				                	</td>
				                </tr>
								<tr>
									<td>Ingresado por:</td>
									<td><h:outputText value="#{oaManagerBean.selectedOA.usuario}"/></td>
								</tr>
								<tr>
									<td>Fecha de ingreso:</td>
									<td><h:outputText value="#{oaManagerBean.selectedOA.fecha_ingreso}"/></td>
								</tr>
								<tr>
				                	<td><h:outputText value="URL:" /></td>
				                	<td>
			                			<h:outputLink target="_blank" value="#{oaManagerBean.selectedOA.url}">#{oaManagerBean.selectedOA.url}</h:outputLink>
				                	</td>
				                </tr>
								<f:facet name="footer">
									<p:commandButton value="Cerrar" onclick="PF('detailOADialog').hide();" ajax="true" icon="ui-icon-closethick"/>
								</f:facet>
							</table>
						</div>
					</p:dialog>
				</p:outputPanel>
				<p:outputPanel id="panelNull" layout="block" rendered="#{oaManagerBean.selectedOA == null}">
					<p:dialog header="Detalles del objeto de aprendizaje" showEffect="fade" hideEffect="fade" widgetVar="detailOADialog" modal="true" resizable="false">
						<p style="width:300px; text-align:center;">Debe seleccionar un objeto de aprendizaje para visualizar.</p>
						<f:facet name="footer">
							<p:commandButton value="Cerrar" onclick="PF('detailOADialog').hide();" ajax="true" icon="ui-icon-closethick"/>
						</f:facet>
					</p:dialog>
				</p:outputPanel>
			</h:form>
			
			<h:form id="addOAForm">
				<p:dialog header="Agregar objeto de aprendizaje" showEffect="fade" hideEffect="fade" widgetVar="addOADialog" modal="true" resizable="false">
					<table>
						<tr>
							<td>Ingrese la URL:</td>
							<td>
								<p:inputText id="addURL" value="#{oaManagerBean.urlOAMB}" required="true" 
									requiredMessage="Debe ingresar una URL">
									<f:validator validatorId="inputValidator" />
									<f:validator validatorId="urlValidator" />
									<p:watermark for="addURL" value="Ej: http://www. ..." />
								</p:inputText>
							</td>
						</tr>
						<tr>
							<td colspan="2">
								<p:message for="addURL" severity="error"></p:message>
							</td>
						</tr>
						<tr>
							<td>Ingrese el título:</td>
							<td>
								<p:inputText id="addTitulo" value="#{oaManagerBean.tituloOAMB}" required="true" 
									requiredMessage="Debe ingresar un título" validatorMessage="El titulo debe ser minimo de 5 caracteres">
									<f:validator validatorId="inputValidator" />
									<p:watermark for="addTitulo" value="Ej: Título OA" />
									<f:validateLength minimum="5"/>
								</p:inputText>
							</td>
						</tr>
						<tr>
							<td colspan="2">
								<p:message for="addTitulo" severity="error"></p:message>
							</td>
						</tr>
						<tr>
							<td>Ingrese alguna descripción:</td>
							<td>
								<p:inputText id="addDescripcion" value="#{oaManagerBean.descripcionOAMB}" >
									<f:validator validatorId="inputValidator" />
									<p:watermark for="addDescripcion" value="Ej: Descripción" />
								</p:inputText>
							</td>
						</tr>
						<tr>
							<td colspan="2">
								<p:message for="addDescripcion" severity="error"></p:message>
							</td>
						</tr>
						<tr>
							<td>Ingrese correo del usuario:</td>
							<td>
								<p:inputText id="addCorreo" value="#{oaManagerBean.correoOAMB}" required="true" 
									requiredMessage="Debe ingresar un correo electrónico.">
									<f:validator validatorId="correoValidator" />
								</p:inputText>
							</td>
						</tr>
						<tr>
							<td colspan="2"><p:message for="addCorreo" severity="error"></p:message></td>
						</tr>
						<f:facet name="footer">
							<p:commandButton action="#{oaManagerBean.addOA}" value="Agregar" 
								update=":formOAs,:addOAForm" oncomplete="if(args.validationFailed) {addOADialog.show()}"
								ajax="true" icon="ui-icon-plus">
							</p:commandButton>
						</f:facet>
					</table>
				</p:dialog>
			</h:form>
			
			<h:form id="editOAForm" >
				<p:outputPanel id="panelNotNull" layout="block" rendered="#{oaManagerBean.selectedOA != null}">
					<p:dialog header="Editar OA ''#{oaManagerBean.selectedOA.titulo}''" widgetVar="editOADialog"
						showEffect="fade" hideEffect="fade"  modal="true" resizable="false">
						<table>
							<tr>
								<td>Ingrese la URL:</td>
								<td>
									<p:inputText id="editURL" value="#{oaManagerBean.urlOAMB}" >
										<f:validator validatorId="inputValidator" />
										<f:validator validatorId="urlValidator" />
										<p:watermark for="editURL" value="Ej: http://www. ..." />
									</p:inputText>
								</td>
							</tr>
							<tr>
								<td colspan="2">
									<p:message for="editURL" severity="error"></p:message>
								</td>
							</tr>
							<tr>
								<td>Ingrese el título:</td>
								<td>
									<p:inputText id="editTitulo" value="#{oaManagerBean.tituloOAMB}" validatorMessage="El titulo debe ser minimo de 5 caracteres">
										<f:validator validatorId="inputValidator" />
										<f:validateLength minimum="5"/>
										<p:watermark for="editTitulo" value="Ej: Título OA" />
									</p:inputText>
								</td>
							</tr>
							<tr>
								<td colspan="2">
									<p:message for="editTitulo" severity="error"></p:message>
								</td>
							</tr>
							<tr>
								<td>Ingrese alguna descripción:</td>
								<td>
									<p:inputText id="editDescripcion" value="#{oaManagerBean.descripcionOAMB}" >
										<f:validator validatorId="inputValidator" />
										<p:watermark for="editDescripcion" value="Ej: Descripción" />
									</p:inputText>
								</td>
							</tr>
							<tr>
								<td colspan="2">
									<p:message for="editDescripcion" severity="error"></p:message>
								</td>
							</tr>
							<tr>
								<td>Ingrese correo del usuario:</td>
								<td>
									<p:inputText id="editCorreo" value="#{oaManagerBean.correoOAMB}">
										<f:validator validatorId="correoValidator" />
									</p:inputText>
								</td>
							</tr>
							<tr>
								<td colspan="2"><p:message for="editCorreo" severity="error"></p:message></td>
							</tr>
							<f:facet name="footer">
								<p:commandButton action="#{oaManagerBean.editOA}" value="Editar" 
									update=":formOAs,:editOAForm" oncomplete="if(args.validationFailed) {editOADialog.show()}"
									ajax="true" icon="ui-icon-wrench">
								</p:commandButton>
							</f:facet>
						</table>
					</p:dialog>
				</p:outputPanel>
				<p:outputPanel id="panelNull" layout="block" rendered="#{oaManagerBean.selectedOA == null}">
					<p:dialog header="Editar OA" widgetVar="editOADialog"
						showEffect="fade" hideEffect="fade"  modal="true" resizable="false">
						<p style="width:300px; text-align:center;">Debe seleccionar un objeto de aprendizaje para editar</p>
						<f:facet name="footer">
							<p:commandButton value="Cerrar" onclick="PF('editOADialog').hide();" ajax="true" icon="ui-icon-closethick"/>
						</f:facet>
					</p:dialog>
				</p:outputPanel>
			</h:form>
			
			<h:form id="deleteOAForm">
				<p:outputPanel id="panelNotNull" layout="block" rendered="#{oaManagerBean.selectedOA != null}">
					<p:dialog header="Eliminar OA" showEffect="fade" hideEffect="fade" widgetVar="deleteOADialog" modal="true" resizable="false">
						<p style="width:400px; text-align:center;">¿Esta seguro de eliminar el objeto de aprendizaje "#{oaManagerBean.selectedOA.titulo}"?</p>
						<f:facet name="footer">
							<p:commandButton action="#{oaManagerBean.deleteOA}" value="Si" 
								update=":formOAs,:deleteOAForm" ajax="true" icon="ui-icon-check"/>
							<p:commandButton value="No" onclick="PF('deleteOADialog').hide();" ajax="true" icon="ui-icon-closethick"/>
						</f:facet>
					</p:dialog>
				</p:outputPanel>
				<p:outputPanel id="panelNull" layout="block" rendered="#{oaManagerBean.selectedOA == null}">
					<p:dialog header="Eliminar OA" showEffect="fade" hideEffect="fade" widgetVar="deleteOADialog" modal="true" resizable="false">
						<p style="width:300px; text-align:center;">Debe seleccionar un objeto de aprendizaje para eliminar</p>
						<f:facet name="footer">
							<p:commandButton value="Cerrar" onclick="PF('deleteOADialog').hide();" ajax="true" icon="ui-icon-closethick"/>
						</f:facet>
					</p:dialog>
				</p:outputPanel>
			</h:form>
								
			<p:ajaxStatus onstart="PF('statusDialog').show()" onsuccess="PF('statusDialog').hide()" />
			<p:dialog widgetVar="statusDialog" modal="true" draggable="false" closable="false" resizable="false" showHeader="false">
			    <p:graphicImage name="img/ajaxloader.gif" />
			</p:dialog>
								
		</ui:define>
	</ui:composition>
	
</h:body>
</html>