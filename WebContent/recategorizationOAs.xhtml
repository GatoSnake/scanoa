<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	  xmlns:ui="http://java.sun.com/jsf/facelets" 
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:p="http://primefaces.org/ui">
      
<h:body>
	<f:metadata>
		<f:event listener="#{loginBean.isAdmin}" type="preRenderView" />
	</f:metadata>
	<ui:composition template="/templates/mainTemplate.xhtml">
		<ui:define name="title">Recategorización de OAS - SCANOA</ui:define>
		<ui:define name="content">
			<div id="contentOAs">
				<h3>Sistema de Recategorización de Objetos de Aprendizaje</h3>
				<br/>
				<p:outputPanel id="msgFecha" layout="block">
					<p style="text-align:center">La última recategorización de los objetos de aprendizaje fue realizado 
						en la fecha <strong>#{recategorizationBean.lastRecatgDate}</strong> a las 
						<strong>#{recategorizationBean.lastRecatgTime}</strong> horas.
					</p>
				</p:outputPanel>
				<br/>
				<p:outputPanel id="msgRec" layout="block">
					<p:outputPanel id="noProcessRec" layout="block" rendered="#{recategorizationBean.flagConsejo==0}">
						<p style="text-align:center">
							No es necesario realizar el proceso de recategorización.
						</p>
					</p:outputPanel>
					<p:outputPanel id="yesProcessRec" layout="block" rendered="#{recategorizationBean.flagConsejo==1}">
						<p style="text-align:center; color:red;">
							Se han realizado cambios a los tópicos y a su jerarquía. Se recomienda realizar el proceso de recategorización.
						</p>
					</p:outputPanel>
				</p:outputPanel>
				<br/>
				<h:form id="recategorization" style="width:180px; margin:0 auto;">
					<p:commandButton value="Recategorizar OAs" icon="ui-icon-document" oncomplete="PF('recatOADialog').show()"/>		
				</h:form>
				
				<h:form id="recatOAForm">
					<p:dialog header="Recategorizar OAs" showEffect="fade" hideEffect="fade" widgetVar="recatOADialog" modal="true" resizable="false">
						<p:outputPanel id="noProcessRec" layout="block" rendered="#{recategorizationBean.flagConsejo==0}">
							<p style="width:400px; text-align:center; font-weight:bold;">
								¿Esta seguro de realizar de todas formas la recategorización?
							</p>
							<br/>
							<p style="width:400px; text-align:center">
								Este proceso puede demorarse dependiendo de la cantidad de OAs en el sistema.
							</p>
						</p:outputPanel>
						<p:outputPanel id="yesProcessRec" layout="block" rendered="#{recategorizationBean.flagConsejo==1}">
							<p style="width:400px; text-align:center; font-weight:bold;">
								¿Esta seguro de realizar la recategorización?
							</p>
							<br/>
							<p style="width:400px; text-align:center">
								Este proceso puede demorarse dependiendo de la cantidad de OAs en el sistema.
							</p>
						</p:outputPanel>
						<f:facet name="footer">
							<p:commandButton action="#{recategorizationBean.recategorizarOAs}" value="Si" 
								update=":msgFecha,:msgRec,:recatOAForm" ajax="true" icon="ui-icon-check"/>
							<p:commandButton value="No" onclick="PF('recatOADialog').hide();" ajax="true" icon="ui-icon-closethick"/>
						</f:facet>
					</p:dialog>
				</h:form>
								
				<p:ajaxStatus onstart="PF('statusDialog').show()" onsuccess="PF('statusDialog').hide()" />
				<p:dialog widgetVar="statusDialog" modal="true" draggable="false" closable="false" resizable="false" showHeader="false">
				    <p:graphicImage name="img/ajaxloader.gif" />
				</p:dialog>
			</div>								
		</ui:define>
	</ui:composition>
	
</h:body>
</html>